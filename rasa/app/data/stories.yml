version: "3.1"

stories:
  - story: check token status
    steps:
      - intent: check_token_status
      - action: action_check_token_status

  - story: fetch token and preferences silently
    steps:
      - intent: provide_email
      - action: action_fetch_auth_token
      - slot_was_set:
          - auth_token: null
      - action: action_fetch_user_preferences

  - story: display preferences on request
    steps:
      - intent: display_preferences
      - action: utter_display_preferences

  - story: generate PDF story
    steps:
      - intent: request_pdf
      - action: action_generate_pdf

  - story: happy greeting path
    steps:
    - intent: greet
    - action: utter_greet

  - story: happy mood path
    steps:
    - intent: mood_unhappy
    - action: utter_cheer_up
    - action: utter_did_that_help
    - intent: affirm
    - action: utter_happy

  - story: unhappy mood path
    steps:
    - intent: mood_unhappy
    - action: utter_cheer_up
    - action: utter_did_that_help
    - intent: deny
    - action: utter_goodbye

  - story: successful single trip flight booking
    steps:
    - intent: search_flights
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: single_trip
    - action: action_set_trip_type
    - slot_was_set:
        - trip_type: "single"
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: provide_location
      entities:
        - airport_code: "KUL"
    - slot_was_set:
        - origin: "KUL"
    - intent: provide_location
      entities:
        - airport_code: "SIN"
    - slot_was_set:
        - destination: "SIN"
    - intent: provide_travel_dates
      entities:
        - date: "2024-05-15"
    - slot_was_set:
        - departure_date: "2024-05-15"
    - action: flight_search_form
    - active_loop: null
    - action: action_search_flights

  - story: successful round trip flight booking
    steps:
    - intent: search_flights
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: round_trip
    - action: action_set_trip_type
    - slot_was_set:
        - trip_type: "round"
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: provide_location
      entities:
        - airport_code: "KUL"
    - slot_was_set:
        - origin: "KUL"
    - intent: provide_location
      entities:
        - airport_code: "SIN"
    - slot_was_set:
        - destination: "SIN"
    - intent: provide_travel_dates
      entities:
        - date: "2024-05-15"
    - slot_was_set:
        - departure_date: "2024-05-15"
    - intent: provide_return_date
      entities:
        - date: "2024-05-20"
    - slot_was_set:
        - return_date: "2024-05-20"
    - action: flight_search_form
    - active_loop: null
    - action: action_search_flights

  - story: no flights found
    steps:
    - intent: search_flights
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: single_trip
    - action: action_set_trip_type
    - slot_was_set:
        - trip_type: "single"
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: provide_location
      entities:
        - airport_code: "KUL"
    - slot_was_set:
        - origin: "KUL"
    - intent: provide_location
      entities:
        - airport_code: "SIN"
    - slot_was_set:
        - destination: "SIN"
    - intent: provide_travel_dates
      entities:
        - date: "2024-05-15"
    - slot_was_set:
        - departure_date: "2024-05-15"
    - action: flight_search_form
    - active_loop: null
    - action: action_search_flights
    - slot_was_set:
        - flights_found: false
    - action: utter_no_flights_found

  - story: change trip type during booking
    steps:
    - intent: search_flights
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: single_trip
    - action: action_set_trip_type
    - slot_was_set:
        - trip_type: "single"
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: round_trip
    - action: action_set_trip_type
    - slot_was_set:
        - trip_type: "round"
    - action: flight_search_form
    - active_loop: flight_search_form

  - story: flight to hotel transition
    steps:
    - intent: search_flights
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: single_trip
    - action: action_set_trip_type
    - slot_was_set:
        - trip_type: "single"
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: provide_location
      entities:
        - airport_code: "KUL"
    - slot_was_set:
        - origin: "KUL"
    - intent: provide_location
      entities:
        - airport_code: "SIN"
    - slot_was_set:
        - destination: "SIN"
    - intent: provide_travel_dates
      entities:
        - date: "2024-05-15"
    - slot_was_set:
        - departure_date: "2024-05-15"
    # Complete flight search
    - action: flight_search_form
    - active_loop: null
    - action: action_search_flights
    - slot_was_set:
        - flights_found: true
    - action: action_mark_flight_search_complete
    - slot_was_set:
        - flight_search_completed: true
    # Transition to hotel search
    - intent: search_hotels
    - action: action_reset_hotel_form
    - action: hotel_search_form
    - active_loop: hotel_search_form
    # Hotel form filling
    - intent: provide_location
      entities:
        - city_code: "SIN"
    - slot_was_set:
        - city: "SIN"
    - intent: provide_travel_dates
      entities:
        - date: "2024-05-15"
    - slot_was_set:
        - check_in: "2024-05-15"
    - intent: provide_travel_dates
      entities:
        - date: "2024-05-20"
    - slot_was_set:
        - check_out: "2024-05-20"
    # Complete hotel search
    - action: hotel_search_form
    - active_loop: null
    - action: action_search_hotels
    - action: action_mark_hotel_search_complete
    - slot_was_set:
        - hotel_search_completed: true
    # Optionally save the request
    - intent: save_travel_request
    - action: action_save_travel_request
    - action: action_listen

  - story: select and confirm flight
    steps:
    - intent: select_flight
    - action: action_select_flight
    - intent: confirm_flight
    - action: action_mark_flight_search_complete
    - slot_was_set:
        - flight_search_completed: true
    - action: utter_search_complete
    - action: action_listen

  - story: single trip selection flow
    steps:
      - intent: search_flights
      - action: flight_search_form
      - active_loop: flight_search_form
      - intent: single_trip
      - action: action_set_trip_type
      - slot_was_set:
          - trip_type: "single"
      - action: flight_search_form
      - active_loop: flight_search_form

  - story: book a single trip flight
    steps:
    - intent: search_flights
    - action: flight_search_form
    - active_loop: flight_search_form
    - intent: single_trip
    - action: action_set_trip_type
    - slot_was_set:
        - trip_type: "single"
    - action: flight_search_form
    - active_loop: flight_search_form