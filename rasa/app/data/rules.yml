version: "3.1"

rules:

  - rule: Offer restart after flight search failure
    condition:
      - slot_was_set:
          - flights_found: false
    steps:
      - action: utter_no_flights_found
      - action: action_offer_restart
      - action: action_listen

  - rule: Offer restart after successful flight search
    condition:
      - slot_was_set:
          - flights_found: true
    steps:
      - action: action_offer_restart
      - action: action_listen

  - rule: Handle conversation restart
    steps:
      - intent: restart_conversation
      - action: action_restart_conversation
      - action: action_listen

  - rule: Handle restart decline with goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye
      - action: action_listen

  - rule: PDF generation rule
    steps:
      - intent: request_pdf
      - action: action_generate_pdf
  - rule: Activate flight search form
    steps:
      - intent: search_flights
      - action: flight_search_form
      - active_loop: flight_search_form

  - rule: Submit flight search form and handle success
    condition:
      - active_loop: flight_search_form
    steps:
      - action: flight_search_form
      - active_loop: null
      - action: action_search_flights
      - slot_was_set:
        - flights_found: true
      - action: action_mark_flight_search_complete
      - action: action_listen

  - rule: Submit flight search form and handle failure
    condition:
      - active_loop: flight_search_form
    steps:
      - action: flight_search_form
      - active_loop: null
      - action: action_search_flights
      - slot_was_set:
          - flights_found: false
      - action: utter_no_flights_found
      - action: action_listen

  - rule: Activate hotel search form
    steps:
      - intent: search_hotels
      - action: action_reset_hotel_form
      - action: hotel_search_form
      - active_loop: hotel_search_form

  - rule: Submit hotel search form
    condition:
      - active_loop: hotel_search_form
    steps:
      - action: hotel_search_form
      - active_loop: null
      - action: action_search_hotels
      - action: action_mark_hotel_search_complete
      - action: action_listen

  - rule: Complete hotel search
    condition:
      - slot_was_set:
          - hotel_search_completed: true
    steps:
      - action: action_listen

  - rule: Say goodbye anytime the user says goodbye
    steps:
      - intent: goodbye
      - action: utter_goodbye

  - rule: Say 'I am a bot' anytime the user challenges
    steps:
      - intent: bot_challenge
      - action: utter_iamabot

  - rule: Set single trip type
    steps:
      - intent: single_trip
      - action: action_set_trip_type
      - slot_was_set:
          - trip_type: "single"
      - action: action_listen

  - rule: Set round trip type
    steps:
      - intent: round_trip
      - action: action_set_trip_type
      - slot_was_set:
          - trip_type: "round"
      - action: action_listen

  - rule: Handle trip type selection
    steps:
      - intent: choose_trip_type
      - action: utter_ask_trip_type
      - action: action_listen